<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>

<style>
:root{
  --bg:#fff7d6; --card:#fff; --ink:#2b2b2b;
  --shadow:0 10px 22px rgba(0,0,0,.10);
  --radius:18px;
  --blue:#3aa0ff; --green:#22c55e; --pink:#ff5aa5; --purple:#8b5cf6;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;
  background:var(--bg);
  color:var(--ink);
  padding-bottom:110px;
}
.wrap{max-width:520px;margin:auto;padding:16px;}
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:14px;
  margin-bottom:12px;
}
h1{margin:0;font-size:22px;}
.sub{font-size:12px;opacity:.8;margin-bottom:10px;}
.row{display:flex;gap:8px;}
input{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:2px solid rgba(0,0,0,.15);
}
button{
  border:none;
  border-radius:14px;
  padding:12px;
  font-weight:900;
  cursor:pointer;
}
.add{background:linear-gradient(135deg,var(--blue),var(--purple));color:#fff;}
.reset{background:#eee;}
.sync{background:#fff;border:2px solid rgba(0,0,0,.15);}
ul{list-style:none;padding:0;margin:0;display:grid;gap:8px;}
li{
  display:flex;gap:10px;align-items:center;
  padding:12px;border-radius:14px;
  background:rgba(0,0,0,.05);
}
li.done{opacity:.6;text-decoration:line-through;}
.toast{
  position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
  background:#000;color:#fff;padding:10px 14px;
  border-radius:999px;font-size:13px;
  opacity:0;transition:.2s;
}
.toast.show{opacity:1;}
.backBar{
  position:fixed;left:0;right:0;bottom:0;
  padding:12px;background:#fff;border-top:2px solid rgba(0,0,0,.1);
}
.backBtn{
  display:block;text-align:center;
  padding:14px;border-radius:16px;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  color:#fff;font-weight:900;text-decoration:none;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>â­ ä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>
  <div class="sub">å®¶æ—ã§å…±æœ‰ã§ãã¾ã™</div>

  <div class="card">
    <div class="row">
      <input id="input" placeholder="ã‚„ã‚‹ã“ã¨ã‚’å…¥åŠ›">
      <button class="add" id="addBtn">ï¼‹</button>
    </div>
  </div>

  <div class="card">
    <ul id="list"></ul>
  </div>

  <div class="card">
    <button class="reset" id="resetBtn">ğŸ”„ å…¨éƒ¨ãƒªã‚»ãƒƒãƒˆ</button>
    <button class="sync" id="syncBtn">ğŸ”„ å…±æœ‰ã‚’æ›´æ–°</button>
  </div>
</div>

<div class="toast" id="toast"></div>
<div class="backBar">
  <a class="backBtn" href="index.html">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
</div>

<script>
(() => {
  /* ========= GAS è¨­å®š ========= */
  const API_URL = "https://script.google.com/macros/s/AKfycbxVT20cF2cEQwbXWEn4_MlvKBDAq9YTW6mcewmPz8imWyrR39MnuqdPxQ9ZXO9Q91JG/exec";
  const API_TOKEN = "kids-2026-0130-asahi-0620";

  const KEY_TASKS = "todo_tasks_v1";

  async function remoteGet(key){
    const url = API_URL + "?mode=load&token=" + API_TOKEN + "&key=" + key;
    const r = await fetch(url);
    const j = await r.json();
    return j.ok ? j.data : null;
  }
  async function remoteSet(key,data){
    return fetch(API_URL,{
      method:"POST",
      headers:{"Content-Type":"text/plain;charset=utf-8"},
      body:JSON.stringify({mode:"save",token:API_TOKEN,key,data})
    }).then(r=>r.json());
  }

  /* ========= state ========= */
  let tasks = [];

  const el = {
    input:document.getElementById("input"),
    list:document.getElementById("list"),
    toast:document.getElementById("toast"),
  };

  function toast(msg){
    el.toast.textContent = msg;
    el.toast.classList.add("show");
    setTimeout(()=>el.toast.classList.remove("show"),1200);
  }

  function render(){
    el.list.innerHTML = "";
    if(tasks.length===0){
      el.list.innerHTML = "<li>ã¾ã ãªã„ã‚ˆ</li>";
      return;
    }
    tasks.forEach(t=>{
      const li=document.createElement("li");
      li.className = t.done ? "done" : "";
      const cb=document.createElement("input");
      cb.type="checkbox";
      cb.checked=t.done;
      cb.onchange=()=>{
        t.done=cb.checked;
        save();
      };
      const span=document.createElement("span");
      span.textContent=t.text;
      li.append(cb,span);
      el.list.appendChild(li);
    });
  }

  async function save(){
    const r = await remoteSet(KEY_TASKS,tasks);
    if(r.ok) toast("å…±æœ‰ä¿å­˜OK");
    else toast("ä¿å­˜å¤±æ•—");
    render();
  }

  document.getElementById("addBtn").onclick=()=>{
    const v=el.input.value.trim();
    if(!v) return;
    tasks.unshift({id:Date.now(),text:v,done:false});
    el.input.value="";
    save();
  };

  document.getElementById("resetBtn").onclick=()=>{
    if(!confirm("å…¨éƒ¨ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ"))return;
    tasks=[];
    save();
  };

  document.getElementById("syncBtn").onclick=async()=>{
    const r = await remoteGet(KEY_TASKS);
    if(Array.isArray(r)){
      tasks=r;
      toast("å…±æœ‰ã‚’æ›´æ–°ã—ãŸã‚ˆ");
      render();
    }
  };

  /* ========= init ========= */
  (async()=>{
    const r = await remoteGet(KEY_TASKS);
    if(Array.isArray(r)) tasks=r;
    render();
  })();
})();
</script>
</body>
</html>
